<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kitty Academy</title> 
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <link rel="manifest" href="/manifest.json">
    
    <style>
        /* ========================================================== */
        /* CSS: Estilo Limpo e Moderno (Mobile-First) */
        /* ========================================================== */
        :root {
            --primary-color: #007bff; /* Azul vibrante */
            --secondary-color: #28a745; /* Verde para sucesso */
            --danger-color: #dc3545; /* Vermelho para perda/alerta */
            --warning-color: #ffc107; /* Amarelo para pausa */
            --text-color: #333333;
            --background-page: #f8f9fa;
            --background-card: #ffffff;
            --nav-background: #ffffff;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        /* Modo Escuro */
        body.dark-mode {
            --primary-color: #4da6ff;
            --secondary-color: #6cff87;
            --danger-color: #ff6b6b;
            --warning-color: #ffea00;
            --text-color: #f0f0f0;
            --background-page: #121212;
            --background-card: #1e1e1e;
            --nav-background: #1e1e1e;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
        }

        /* Tema Hello Kitty (Ajustado) */
        body.hello-kitty-theme {
            --primary-color: #ff69b4; /* Pink */
            --secondary-color: #4CAF50; /* Verde um pouco mais escuro para bot√µes */
            --danger-color: #E91E63;
            --warning-color: #ffeb3b;
            --background-page: #fce4ec; /* Rosa claro */
            --background-card: #ffffff;
            --nav-background: #ffebee;
            --text-color: #d81b60;
        }
        
        /* Estilo para bot√µes de √Ågua (Novo) */
        .water-controls {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin-top: 5px;
        }

        .water-controls button {
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 50%;
            width: 35px;
            height: 35px;
            font-size: 1.2em;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            transition: background-color 0.3s;
        }

        .water-controls button:hover {
            opacity: 0.8;
        }


        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            transition: background-color 0.3s, color 0.3s;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--background-page);
            color: var(--text-color);
        }

        #app-container {
            max-width: 500px;
            margin: 0 auto;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            position: relative;
        }

        /* ------------------ Header (Escondido no Onboarding) ------------------ */
        #app-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 15px; /* Ajuste o padding vertical se a logo for grande */
            background-color: var(--background-card);
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
            position: sticky;
            top: 0;
            z-index: 10;
        }
        #app-header.hidden { display: none; }

        /* Estilo para a logo no header */
        #app-header #app-logo {
            height: 90px; /* Altura fixa para a logo */
            width: auto; /* Mant√©m a propor√ß√£o */
            margin-right: 10px; /* Espa√ßamento da logo para os bot√µes */
        }
        
        #app-header h1 { /* Este estilo agora √© menos relevante se usar a logo imagem */
            font-size: 1.5em;
            color: var(--text-color); 
        }
        
        #header-buttons button {
            background: none;
            border: none;
            color: var(--text-color);
            font-size: 1.2em;
            margin-left: 10px;
            cursor: pointer;
        }

        /* ------------------ Conte√∫do Principal ------------------ */
        #app-content {
            flex-grow: 1;
            padding: 20px 15px;
            padding-bottom: 80px; /* Espa√ßo para o menu inferior */
            overflow-y: auto;
        }

        .app-screen h2 {
            color: var(--primary-color);
            margin-bottom: 20px;
            padding-bottom: 5px;
            border-bottom: 2px solid var(--primary-color);
            font-size: 1.8em;
        }

        .hidden { display: none; }

        /* ------------------ Cards e Elementos Comuns ------------------ */
        .card {
            background-color: var(--background-card);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }
        
        .card-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
        }

        button.primary-btn {
            width: 100%;
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 12px;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 10px;
            transition: background-color 0.3s;
        }
        
        button.primary-btn:hover {
            opacity: 0.9;
        }
        
        /* Input de Formul√°rio */
        .form-input {
            width: 100%;
            padding: 10px;
            margin-bottom: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            background-color: var(--background-card);
            color: var(--text-color);
            resize: none; /* Para textarea */
        }
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: var(--primary-color);
        }
        
        /* Adi√ß√£o da classe para inputs lado a lado (Corre√ß√£o) */
        .input-group {
            display: flex;
            gap: 15px; /* Espa√ßo entre os campos */
            margin-bottom: 5px;
        }
        .input-group .form-group {
            flex: 1; /* Garante que os campos dentro ocupem o mesmo espa√ßo */
        }
        .input-group .form-input {
            margin-bottom: 10px; /* Mant√©m o espa√ßamento dos inputs */
        }


        /* Sele√ß√£o de Metas (Onboarding) */
        .goal-selection {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-bottom: 15px;
        }
        .goal-option {
            border: 2px solid #ccc;
            border-radius: 8px;
            padding: 10px;
            cursor: pointer;
            transition: all 0.2s;
        }
        .goal-option.selected {
            border-color: var(--primary-color);
            background-color: rgba(0, 123, 255, 0.1);
        }
        
        /* ------------------ Navega√ß√£o Inferior (Escondida no Onboarding) ------------------ */
        #bottom-nav {
            display: flex;
            justify-content: space-around;
            align-items: center;
            position: fixed;
            bottom: 0;
            width: 100%;
            max-width: 500px;
            height: 65px;
            background-color: var(--nav-background);
            box-shadow: var(--shadow);
            border-top: 1px solid rgba(0, 0, 0, 0.1);
            z-index: 20;
        }
        #bottom-nav.hidden { display: none; }

        .nav-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: none;
            border: none;
            color: var(--text-color);
            padding: 5px;
            cursor: pointer;
            font-size: 0.75em;
            opacity: 0.6;
        }

        .nav-btn i {
            font-size: 1.3em;
            margin-bottom: 2px;
        }

        .nav-btn.active {
            color: var(--primary-color);
            opacity: 1;
        }

        /* Estilos do Dashboard */
        #dashboard-header {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            margin-bottom: 20px;
            padding: 15px;
            border-radius: 10px;
            background-color: var(--background-card);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        #dashboard-header img {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            margin-bottom: 10px;
            border: 3px solid var(--primary-color);
            object-fit: cover; /* Garante que a imagem se ajuste bem */
        }
        #dashboard-header h3 {
            margin: 5px 0;
            color: var(--text-color);
        }
        #dashboard-header p {
            font-size: 0.9em;
            color: #6c757d;
        }
        .stat-circle h4 {
            font-size: 1.8em;
            color: var(--primary-color);
            margin-bottom: 5px;
        }
        .evolution-stat {
            text-align: center;
            padding: 10px;
            background-color: var(--background-page);
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
        }
        .evolution-stat h4 {
            font-size: 1.5em;
            color: var(--primary-color);
        }
        /* Estilo do Cron√¥metro */
        #timer {
            font-size: 3em;
            font-weight: bold;
            color: var(--danger-color);
            text-align: center;
            margin: 15px 0;
        }
        #timer-controls button {
            width: 32%;
            margin: 5px 0;
            padding: 10px;
            border-radius: 5px;
            border: none;
            cursor: pointer;
            font-size: 0.9em;
            color: white;
            transition: opacity 0.3s;
        }
        #btn-timer-start { background-color: var(--secondary-color); }
        #btn-timer-pause { background-color: var(--warning-color); }
        #btn-timer-reset { background-color: var(--danger-color); }
        
        /* Estilo espec√≠fico para Hist√≥rico de Treinos */
        .historico-treino-item {
            border-left: 5px solid var(--secondary-color);
            padding: 10px;
            margin-bottom: 10px;
            background-color: rgba(40, 167, 69, 0.05);
            border-radius: 5px;
        }
    </style>
</head>
<body>

    <div id="app-container">

        <header id="app-header" class="hidden">
            
            <img id="app-logo" src="https://i.postimg.cc/fLDytx5X/Academia-Borcelle-Academia-logo-preto-e-amarelo-2-1.png" alt="Academia Borcelle Logo"> 
            
            <div id="header-buttons">
                <button id="dark-mode-toggle" aria-label="Alternar Modo Escuro"><i class="fas fa-moon"></i></button>
                <button id="hello-kitty-toggle" aria-label="Alternar Tema Hello Kitty"><i class="fas fa-cat"></i></button>
            </div>
        </header>

        <main id="app-content">
            
            <section id="onboarding-view" class="app-screen hidden">
                <h2 style="text-align: center; border-bottom: none;">üöÄ Boas-Vindas √† Kitty Academy!</h2> 

<p style="text-align: center; margin-bottom: 20px;">Nos diga um pouco sobre voc√™ para personalizarmos seu plano de treino!</p>
                
                <form id="onboarding-form">
                    
                    <div class="card">
                        <h3>1. Seus Dados</h3>
                        <div class="form-group">
                            <label for="onboarding-nome">Seu Nome:</label>
                            <input type="text" id="onboarding-nome" class="form-input" placeholder="Ex: Mariana" required>
                        </div>
                       <div class="form-group">
  <label for="onboarding-data-nascimento">Data de Nascimento:</label>
  <input 
    type="text" 
    id="onboarding-data-nascimento" 
    class="form-input" 
    placeholder="dd/mm/aaaa" 
    maxlength="10"
    required
  >
  <small id="data-error" style="color: red; display: none;">Data inv√°lida</small>
</div>
                        <div class="form-group">
                            <label for="onboarding-sexo">Sexo:</label>
                            <select id="onboarding-sexo" class="form-input" required>
                                <option value="" disabled selected>Selecione</option>
                                <option value="M">Masculino</option>
                                <option value="F">Feminino</option>
                                <option value="O">Outro</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="card">
                        <h3>2. Metas F√≠sicas</h3>
                        <div class="input-group">
                            <div class="form-group" style="flex: 1;">
                                <label for="onboarding-peso">Peso Atual (Kg):</label>
                                <input type="number" step="0.1" id="onboarding-peso" class="form-input" placeholder="Ex: 80.5" required>
                            </div>
                            <div class="form-group" style="flex: 1;">
                                <label for="onboarding-altura">Altura (cm):</label>
                                <input type="number" min="120" max="220" id="onboarding-altura" class="form-input" placeholder="Ex: 175" required>
                                <small style="display: block; margin-top: -8px; color: #6c757d;">(Entre 120 e 220 cm)</small>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="onboarding-meta-peso">Meta de Peso (Kg):</label>
                            <input type="number" step="0.1" id="onboarding-meta-peso" class="form-input" placeholder="Ex: 75.0 ou 85.0" required>
                        </div>
                    </div>
                    
                    <div class="card">
                        <h3>3. Qual √© sua Meta Principal?</h3>
                        <div class="goal-selection">
                            <div class="goal-option" data-goal="hipertrofia">
                                <h4>üí™ Hipertrofia (Ganho de Massa)</h4>
                                <p style="font-size: 0.85em;">Foco em aumentar o tamanho muscular atrav√©s de treinos de for√ßa e super√°vit cal√≥rico.</p>
                            </div>
                            <div class="goal-option" data-goal="definicao">
                                <h4>üî™ Defini√ß√£o Muscular (Cutting)</h4>
                                <p style="font-size: 0.85em;">Foco em perder gordura para "mostrar" os m√∫sculos, geralmente com treino e dieta hipocal√≥rica moderada.</p>
                            </div>
                            <div class="goal-option" data-goal="emagrecer">
                                <h4>‚öñÔ∏è Emagrecer (Perda de Peso)</h4>
                                <p style="font-size: 0.85em;">Foco em reduzir o peso corporal, principalmente atrav√©s de d√©ficit cal√≥rico e exerc√≠cios cardiovasculares.</p>
                            </div>
                        </div>
                        <input type="hidden" id="onboarding-meta-selecionada" required>
                    </div>

                    <div class="card">
                        <h3>4. N√≠vel de Experi√™ncia</h3>
                        <div class="input-group">
                            <select id="onboarding-nivel" class="form-input" required>
                                <option value="" disabled selected>Selecione seu N√≠vel</option>
                                <option value="iniciante">Iniciante (Pouca ou Nenhuma Experi√™ncia)</option>
                                <option value="intermediario">Intermediario (Treina h√° 6 meses - 2 anos)</option>
                                <option value="avancado">Avan√ßado (Treina h√° mais de 2 anos com consist√™ncia)</option>
                            </select>
                        </div>
                    </div>

                    <button type="submit" class="primary-btn" style="background-color: var(--secondary-color);">
                        <i class="fas fa-check"></i> Iniciar Minha Jornada na Academia Borcelle
                    </button>
                    
                </form>
            </section>


            <section id="dashboard-view" class="app-screen hidden">
                <div id="dashboard-header">
                    <img id="profile-picture" src="https://via.placeholder.com/80/ff69b4/ffffff?text=K" alt="Foto do Usu√°rio"> 
                    <h3 id="dashboard-saudacao">Ol√°, Usu√°rio üëã</h3> 
                    <p>Idade: <span id="dashboard-idade">--</span> | N√≠vel: <span id="dashboard-nivel">Intermedi√°rio</span></p>
                    <p>Sua meta: <span id="dashboard-meta-foco">Ganho de Massa</span></p>
                </div>
                
                <div class="card-grid">
                    <div class="stat-circle card">
                        <h4><span id="cal-consumida">1200</span>/<span id="cal-meta">2200</span></h4>
                        <p>Calorias (Kcal)</p>
                    </div>
                    <div class="stat-circle card">
                        <h4><span id="agua-copos">3</span>/8</h4>
                        <p>Copos de √Ågua üíß</p>
                        <div class="water-controls">
                            <button id="btn-add-agua-minus">-1</button> 
                            <button id="btn-add-agua-plus">+1</button>
                        </div>
                    </div>
                    <div class="stat-circle card">
                        <h4><span id="treino-pct">60</span>%</h4>
                        <p>Progresso Semanal</p>
                    </div>
                </div>
                <div class="card">
                    <h3>üèãÔ∏è Treino do Dia</h3>
                    <p>Treino de **Peito e Tr√≠ceps** - 6 exerc√≠cios.</p>
                    <p>√öltimo Treino: <span id="last-treino-display">Nenhum registrado.</span></p>
                    <button class="primary-btn nav-link" data-target="treinos-view">Escolher Treino</button>
                </div>
                
                <div class="card">
                    <h3>üìÖ Hist√≥rico</h3>
                    <p>Voc√™ completou <span id="treinos-count">0</span> treinos no total.</p>
                    <button class="primary-btn nav-link" data-target="historico-treinos-view" style="background-color: var(--primary-color);">
                        <i class="fas fa-history"></i> Ver Hist√≥rico Completo
                    </button>
                </div>

                <div class="card">
                    <h3>ü•ó Nutri√ß√£o R√°pida</h3>
                    <p>Caf√© da manh√£ registrado. Pr√≥xima refei√ß√£o: Almo√ßo (13:00).</p>
                    <button class="primary-btn nav-link" data-target="dieta-view" style="background-color: var(--secondary-color);">Registrar Refei√ß√£o</button>
                </div>
            </section>

            <section id="treinos-view" class="app-screen hidden">
                <h2>üèãÔ∏è Selecionar Treino</h2>
                
             <div class="card" 
     style="
       background-image: url('https://i.pinimg.com/736x/eb/3b/70/eb3b703ec55b449fca629a7193d358f9.jpg');
       background-size: cover;
       background-position: center;
       color: #fff;
       text-shadow: 0 1px 4px rgba(0,0,0,0.8);
     ">
  <h3>‚≠ê Flexibilidade Total</h3>
  <p>Monte seu treino na hora, escolhendo os exerc√≠cios que desejar!</p>
  <button class="primary-btn" id="btn-montar-treino" style="background-color: var(--primary-color);">
    <i class="fas fa-plus"></i> Montar meu Pr√≥prio Treino
  </button>
</div>

                <div id="treino-list" class="card-grid">
                    </div>

                <div class="card">
                    <h3>üõ†Ô∏è Gerenciamento</h3>
                    <button class="primary-btn" id="btn-gerenciar-exercicios" style="background-color: #6c757d;">
                        <i class="fas fa-cogs"></i> Gerenciar Exerc√≠cios (Em Breve)
                    </button>
                </div>
            </section>

            <section id="historico-treinos-view" class="app-screen hidden">
                <h2>üìö Hist√≥rico de Treinos</h2>
                <div class="card">
                    <p>Total de treinos conclu√≠dos: <strong id="historico-total-count">0</strong></p>
                </div>
                <div id="historico-list-container" class="card">
                    <p id="historico-vazio" style="text-align: center; color: #6c757d;">Nenhum treino conclu√≠do ainda. Vamos treinar?</p>
                </div>
            </section>

            <section id="personalizar-treino-view" class="app-screen hidden">
                <button id="btn-voltar-da-personalizacao" class="primary-btn" style="width: 150px; background-color: #6c757d; margin-bottom: 20px;"><i class="fas fa-arrow-left"></i> Voltar</button>

                <h2>‚úèÔ∏è Montar/Editar Treino</h2>

                <div class="card">
                    <h3>Nome do Treino</h3>
                    <input type="text" id="input-nome-novo-treino" class="form-input" placeholder="Ex: Treino Personalizado 1">
                    <p style="font-size: 0.85em;">Selecione abaixo os exerc√≠cios que deseja incluir. üëá</p>
                </div>

                <div class="card">
                    <h3>Lista de Exerc√≠cios Dispon√≠veis (Banco)</h3>
                    <div id="exercicio-banco-list">
                        </div>
                    <p style="font-size: 0.85em; margin-top: 10px;">Toque no exerc√≠cio para adicion√°-lo ao seu treino.</p>
                </div>

                <div class="card">
                    <h3>Exerc√≠cios Adicionados (Meu Treino)</h3>
                    <div id="exercicios-selecionados-list">
                        <p style="text-align: center; color: #6c757d;">Nenhum exerc√≠cio adicionado ainda.</p>
                    </div>
                    <button class="primary-btn" id="btn-salvar-treino-personalizado" style="background-color: var(--secondary-color); margin-top: 15px;">
                        <i class="fas fa-save"></i> Salvar e Iniciar Treino
                    </button>
                </div>
            </section>
            
            <section id="execucao-view" class="app-screen hidden">
                <button id="btn-voltar-treino" class="primary-btn" style="width: 150px; background-color: var(--danger-color);"><i class="fas fa-stop-circle"></i> Sair do Treino</button>
                
                <div id="execucao-wrapper" class="card">
                    
                    <div id="exercicio-current">
                        <h3 id="exercicio-nome">SUPINO RETO</h3>
                        <p>S√©rie <span id="serie-atual">1</span> de <span id="total-series">3</span> | Repeti√ß√µes: <span id="repeticoes">10</span></p>
                    </div>
                    
                    <div class="card" style="margin-top: 0; text-align: left;">
                        <h4>üõ†Ô∏è Ajustar S√©rie</h4>
                        <div class="input-group">
                            <input type="number" id="config-reps" placeholder="Reps" value="10" class="form-input" style="flex: 1;">
                            <input type="number" id="config-descanso" placeholder="Descanso (s)" value="60" class="form-input" style="flex: 1;">
                        </div>
                        <input type="number" id="input-carga" placeholder="Carga (Kg)" value="40" class="form-input">
                    </div>

                    <div class="card" style="margin-top: 0; text-align: left;">
                        <h4>üìù Detalhe do Movimento</h4>
                        <textarea id="detalhe-movimento" class="form-input" rows="5" readonly>Instru√ß√µes...</textarea>
                    </div>
                    
                    <div class="card" style="margin-top: 0;">
                        <h4>‚è±Ô∏è Cron√¥metro de Descanso</h4>
                        <div id="timer">00:00</div>
                        <div id="timer-controls">
                            <button id="btn-timer-start"><i class="fas fa-play"></i> Iniciar</button>
                            <button id="btn-timer-pause"><i class="fas fa-pause"></i> Pausar</button>
                            <button id="btn-timer-reset"><i class="fas fa-redo"></i> Resetar</button>
                        </div>
                    </div>
                    
                    <button class="primary-btn" id="btn-completar-serie">
                        <i class="fas fa-check"></i> Registrar S√©rie Conclu√≠da
                    </button>
                    <button class="primary-btn" id="btn-finalizar-treino" style="background-color: var(--secondary-color);">
                        <i class="fas fa-flag-checkered"></i> Finalizar Treino Agora
                    </button>
                    
                </div>
                
                <div class="card">
                    <h3>Lista de Exerc√≠cios: <span id="treino-titulo-execucao"></span></h3>
                    <div id="exercicios-list">
                        </div>
                </div>
            </section>


            <section id="dieta-view" class="app-screen hidden">
                <h2>ü•ó Dieta e Nutri√ß√£o</h2>
                <div class="card">
                    <h3>Plano Alimentar do Dia</h3>
                    <p>Meta: <span id="dieta-cal-meta">2200</span> Kcal. Prote√≠na: 150g (80g consumidos).</p>
                    <p>Sugest√£o: üç£ **Salm√£o grelhado** para o jantar.</p>
                </div>
                
                <div class="card">
                    <h3>Registrar Alimento</h3>
                    <form id="form-refeicao">
                        <input type="text" id="input-alimento" placeholder="Alimento/Refei√ß√£o" class="form-input">
                        <input type="number" id="input-calorias" placeholder="Calorias (Kcal)" min="1" required class="form-input">
                        <button type="submit" class="primary-btn">Adicionar</button>
                    </form>
                </div>
                
                <div class="card">
                    <h3>Hist√≥rico de Refei√ß√µes</h3>
                    <ul id="historico-refeicoes" style="list-style: none; padding: 0;"></ul>
                </div>

            </section>

            <section id="progresso-view" class="app-screen hidden">
                <h2>üìä Progresso - Peso e Evolu√ß√£o</h2>
                
                <div class="card">
                    <h3>Registrar Peso Di√°rio</h3>
                    <form id="form-peso">
                        <input type="number" step="0.1" id="input-peso" placeholder="Peso Atual (Kg)" required class="form-input" style="font-size: 1.5em; text-align: center;">
                        <button type="submit" class="primary-btn">Salvar Peso de Hoje</button>
                    </form>
                </div>
                
                <div class="card">
                    <h3>Sua Evolu√ß√£o</h3>
                    <div class="card-grid">
                        <div class="evolution-stat">
                            <h4 id="peso-atual-display">-- Kg</h4>
                            <p>Peso Atual</p>
                        </div>
                        <div class="evolution-stat">
                            <h4 id="peso-inicial-display">-- Kg</h4>
                            <p>Peso Inicial</p>
                        </div>
                    </div>
                    
                    <div class="evolution-stat card" style="margin-top: 15px;">
                        <h4 id="peso-diferenca-display">-- Kg</h4>
                        <p>Total Evolu√≠do (Perda/Ganho)</p>
                    </div>
                </div>

                <div class="card">
                    <h3>Gr√°fico de Progresso</h3>
                    <canvas id="weight-chart"></canvas>
                </div>
                
                <div class="card">
                    <h3>Outras M√©tricas</h3>
                    <p>Registro de Medidas Corporais (Bra√ßo, Cintura, etc.)</p>
                    <p>Hist√≥rico de Fotos de Progresso.</p>
                </div>
            </section>

            <section id="perfil-view" class="app-screen hidden">
                <h2>üßç‚Äç‚ôÄÔ∏è Perfil</h2>
                <div class="card">
                    <h3>Dados B√°sicos</h3>
                    <p>Nome: <span id="perfil-nome">--</span></p>
                    <p>Idade: <span id="perfil-idade">--</span></p>
                    <p>Objetivo: <span id="perfil-objetivo">--</span></p>
                    <p>N√≠vel: <span id="perfil-nivel">--</span></p>
                    <p>Peso Inicial: <span id="perfil-peso-inicial">--</span> kg</p>
                    <button class="primary-btn" id="btn-reset-onboarding" style="background-color: var(--danger-color); margin-top: 15px;">
                        <i class="fas fa-redo"></i> Refazer Onboarding
                    </button>
                </div>
                
                <div class="card">
                    <h3>Prefer√™ncias</h3>
                    <p>Tema Atual: <span id="tema-atual">CLARO</span></p>
                    <button class="primary-btn" id="btn-mudar-tema-config">Alternar Tema</button>
                </div>
            </section>
            
            <section id="agenda-view" class="app-screen hidden"><h2>üóìÔ∏è Agenda</h2></section>
            <section id="saude-view" class="app-screen hidden"><h2>üíß Sa√∫de e Bem-Estar</h2></section>
            <section id="gamificacao-view" class="app-screen hidden"><h2>üèÖ Gamifica√ß√£o e Conquistas</h2></section>
            <section id="comunidade-view" class="app-screen hidden"><h2>üí¨ Comunidade</h2></section>
            <section id="config-view" class="app-screen hidden"><h2>‚öôÔ∏è Configura√ß√µes e Extras</h2></section>


        </main>

        <nav id="bottom-nav" class="hidden">
            <button class="nav-btn active" data-target="dashboard-view">
                <i class="fas fa-home"></i>
                <span>In√≠cio</span>
            </button>
            <button class="nav-btn" data-target="treinos-view">
                <i class="fas fa-dumbbell"></i>
                <span>Treinos</span>
            </button>
            <button class="nav-btn" data-target="dieta-view">
                <i class="fas fa-utensils"></i>
                <span>Dieta</span>
            </button>
            <button class="nav-btn" data-target="progresso-view">
                <i class="fas fa-chart-line"></i>
                <span>Progresso</span>
            </button>
            <button class="nav-btn" data-target="perfil-view">
                <i class="fas fa-user"></i>
                <span>Perfil</span>
            </button>
        </nav>

    </div>

    <script>
        // ==========================================================
        // 				JAVASCRIPT - L√ìGICA FINAL COMPLETA 		
        // ==========================================================
        
        // Esta fun√ß√£o deve ser chamada antes do DOMContentLoaded
        function applyThemeImmediate(themeName) {
            document.body.classList.remove('dark-mode', 'hello-kitty-theme');
            if (themeName !== 'light') { document.body.classList.add(themeName); }
            localStorage.setItem('theme', themeName);
        }

        // Tenta carregar o tema imediatamente para evitar flash de branco
        let initialTheme = localStorage.getItem('theme') || 'light';
        if (initialTheme === 'light' && window.matchMedia("(prefers-color-scheme: dark)").matches) {
            initialTheme = 'dark-mode';
        }
        applyThemeImmediate(initialTheme);


        // ===================================
        // 1. ESTRUTURA DE DADOS
        // ===================================
        const GOAL_DESCRIPTIONS = {
            hipertrofia: 'Hipertrofia (Ganho de Massa Muscular)',
            definicao: 'Defini√ß√£o Muscular (Foco na Perda de Gordura)',
            emagrecer: 'Emagrecimento (Perda de Peso Total)'
        };
        
        const PROFILE_PICS = {
            iniciante: 'https://i.pinimg.com/736x/5b/1b/fb/5b1bfb11a5895319e6913967765ef287.jpg',
            intermediario: 'https://i.pinimg.com/236x/35/28/04/352804595e0c6f14066348ef7e890252.jpg',
            avancado: 'https://i.pinimg.com/736x/21/51/9a/21519af242d590e2f523c963628e8312.jpg',
            default: 'https://via.placeholder.com/80/ff69b4/ffffff?text=K'
        };

        let treinosData = [
            { id: 'treino-a', nome: 'Treino A: Peito & Tr√≠ceps', foco: 'For√ßa', exercicios: [
                { nome: 'Supino Reto', series: 3, reps: 10, carga: 40, descanso: 60, detalhe: "Peito estufado, esc√°pulas retra√≠das. Des√ßa a barra na linha do peito, cotovelos a 45¬∫. Controle a descida (fase exc√™ntrica)." },
                { nome: 'Supino Inclinado Halteres', series: 3, reps: 12, carga: 16, descanso: 60, detalhe: "Banco inclinado a 30¬∫. Mantenha os halteres alinhados, sem deixar os cotovelos irem para tr√°s da linha do ombro. Foco na por√ß√£o superior do peitoral." },
                { nome: 'Crossover (Alto)', series: 4, reps: 15, carga: 15, descanso: 45, detalhe: "Incline levemente o tronco para a frente. Cruze as m√£os √† frente do corpo, contraindo o peitoral ao m√°ximo. Mantenha a tens√£o constante." },
                { nome: 'Tr√≠ceps Corda', series: 3, reps: 10, carga: 25, descanso: 45, detalhe: "Mantenha os cotovelos fixos ao lado do corpo. Estenda os bra√ßos completamente, separando as pontas da corda na parte inferior para isolar o tr√≠ceps." }
            ]},
            { id: 'treino-b', nome: 'Treino B: Pernas & Abdomen', foco: 'Hipertrofia', exercicios: [
                { nome: 'Agachamento Livre', series: 4, reps: 8, carga: 60, descanso: 90, detalhe: "Coluna reta, joelhos alinhados com a ponta dos p√©s. Des√ßa at√© que as coxas fiquem paralelas ao ch√£o. For√ßa nos calcanhares para subir." },
                { nome: 'Leg Press 45¬∫', series: 3, reps: 12, carga: 120, descanso: 75, detalhe: "P√©s na largura do quadril, no centro da plataforma. N√£o trave os joelhos ao esticar. Mantenha o quadril e a lombar bem apoiados no banco." },
                { nome: 'Extensora', series: 3, reps: 15, carga: 40, descanso: 60, detalhe: "Sente-se de forma que a almofada fique na frente dos tornozelos. Estenda as pernas controladamente, segurando a contra√ß√£o m√°xima no topo." },
                { nome: 'Panturrilha M√°quina', series: 4, reps: 20, carga: 50, descanso: 45, detalhe: "Fa√ßa o movimento completo, alongando bem na descida e elevando o m√°ximo poss√≠vel na subida. Foco total no m√∫sculo da panturrilha." }
            ]},
            { id: 'treino-c', nome: 'Treino C: Costas & B√≠ceps', foco: 'Volume', exercicios: [
                { nome: 'Barra Fixa (Simulada)', series: 3, reps: 10, carga: 0, descanso: 90, detalhe: "Pegada pronada, largura dos ombros. Puxe o corpo para cima at√© o queixo passar a barra. Mantenha o corpo reto. Se usar m√°quina, ajuste a assist√™ncia." },
                { nome: 'Remada Curvada', series: 4, reps: 10, carga: 30, descanso: 75, detalhe: "Incline o tronco a 45¬∫, mantendo a coluna reta. Puxe a barra em dire√ß√£o ao abd√¥men, focando em apertar as esc√°pulas no final do movimento." },
                { nome: 'Rosca Direta', series: 3, reps: 12, carga: 15, descanso: 60, detalhe: "Mantenha os cotovelos fixos ao lado do corpo (sem balan√ßar o tronco). Suba a barra controladamente, girando as m√£os levemente para fora." },
                { nome: 'Rosca Martelo', series: 3, reps: 15, carga: 12, descanso: 45, detalhe: "Pegada neutra (palmas voltadas uma para a outra). Movimento focado no braquial e antebra√ßo. Suba e des√ßa com controle total." }
            ]}
        ];

        // NOVO BANCO DE EXERC√çCIOS PARA CUSTOMIZA√á√ÉO
        const ALL_EXERCISES = [
            { nome: 'Agachamento Livre', foco: 'Pernas', series: 4, reps: 10, carga: 60, descanso: 90, detalhe: "Foco no controle e profundidade. Coluna reta." },
            { nome: 'Supino Reto', foco: 'Peito', series: 3, reps: 10, carga: 40, descanso: 60, detalhe: "Peito estufado, esc√°pulas retra√≠das. Des√ßa controladamente." },
            { nome: 'Remada Curvada', foco: 'Costas', series: 4, reps: 10, carga: 30, descanso: 75, detalhe: "Incline o tronco a 45¬∫, puxando em dire√ß√£o ao abd√¥men." },
            { nome: 'Eleva√ß√£o Lateral', foco: 'Ombros', series: 3, reps: 15, carga: 8, descanso: 45, detalhe: "Eleve os bra√ßos lateralmente at√© a altura dos ombros. N√£o use o trap√©zio." },
            { nome: 'Tr√≠ceps Corda', foco: 'Tr√≠ceps', series: 3, reps: 12, carga: 25, descanso: 45, detalhe: "Mantenha os cotovelos fixos ao lado do corpo. Estenda completamente." },
            { nome: 'Rosca Direta', foco: 'B√≠ceps', series: 3, reps: 12, carga: 15, descanso: 60, detalhe: "Sem balan√ßar o tronco, cotovelos fixos no lugar." },
            { nome: 'Leg Press 45¬∫', foco: 'Pernas', series: 3, reps: 12, carga: 120, descanso: 75, detalhe: "P√©s na largura do quadril, n√£o trave os joelhos." },
            { nome: 'Abdominal Supra', foco: 'Abd√¥men', series: 3, reps: 20, carga: 0, descanso: 30, detalhe: "Foque na contra√ß√£o do abd√¥men, n√£o no pesco√ßo. Suba pouco." },
            { nome: 'Cadeira Extensora', foco: 'Pernas', series: 3, reps: 15, carga: 40, descanso: 60, detalhe: "Segure a contra√ß√£o m√°xima no topo do movimento por 1 segundo." }
        ];
        let customTreino = { nome: '', exercicios: [] }; // Objeto tempor√°rio para montar o treino

        // Objeto de dados do usu√°rio (persistente)
        let userData = JSON.parse(localStorage.getItem('userData')) || {
            nome: null,
            dataNascimento: null,
            sexo: null,
            pesoInicial: null,
            altura: null,
            metaPeso: null,
            metaSelecionada: null,
            nivel: null,
            pesoHistorico: [],
            calorias: 0,
            agua: 0
        };
        
        // Objeto para hist√≥rico (NOVO)
        let userHistory = JSON.parse(localStorage.getItem('userHistory')) || {
            treinosConcluidos: []
        };

        let currentTreino = null;
        let currentExercicioIndex = 0;
        let currentSerie = 1;
        let timerInterval = null;
        let timerRunning = false;
        let timerDuration = 60; // Dura√ß√£o padr√£o do descanso
        let timerRemaining = timerDuration;
        let weightChart;

        // ===================================
        // 2. FUN√á√ïES GERAIS E UTILIT√ÅRIAS
        // ===================================

        function calculateAge(dateString) {
            if (!dateString) return null;
            const today = new Date();
            const birthDate = new Date(dateString);
            let age = today.getFullYear() - birthDate.getFullYear();
            const m = today.getMonth() - birthDate.getMonth();
            if (m < 0 || (m === 0 && today.getDate() < birthDate.getDate())) {
                age--;
            }
            return age;
        }
        
        // Fun√ß√µes de salvamento
        function saveUserData() {
            localStorage.setItem('userData', JSON.stringify(userData));
        }

        function saveUserHistory() {
            localStorage.setItem('userHistory', JSON.stringify(userHistory));
        }


        function getDisplayGoal(key) {
            return GOAL_DESCRIPTIONS[key] || 'N√£o definido';
        }

        function showScreen(targetId, fromOnboarding = false) {
            document.querySelectorAll('.app-screen').forEach(screen => {
                screen.classList.add('hidden');
            });
            document.getElementById(targetId).classList.remove('hidden');

            const header = document.getElementById('app-header');
            const nav = document.getElementById('bottom-nav');

            if (targetId === 'onboarding-view') {
                header.classList.add('hidden');
                nav.classList.add('hidden');
            } else {
                header.classList.remove('hidden');
                nav.classList.remove('hidden');
            }
            
            // Atualizar estado da navega√ß√£o
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.getAttribute('data-target') === targetId) {
                    btn.classList.add('active');
                }
            });

            // L√≥gicas espec√≠ficas de tela
            if (targetId === 'dashboard-view') {
                renderDashboard();
            } else if (targetId === 'treinos-view') {
                renderTreinoList();
            } else if (targetId === 'progresso-view') {
                renderProgresso();
            } else if (targetId === 'perfil-view') {
                renderPerfil();
            } else if (targetId === 'historico-treinos-view') { // NOVO
                renderHistoricoTreinos();
            }
        }

        // ===================================
        // 3. L√ìGICA DO ONBOARDING
        // ===================================
        
        // Configura limites de data (15 a 100 anos)
        function setDateLimits() {
            const dateInput = document.getElementById('onboarding-data-nascimento');
            const today = new Date();
            
            // Data M√°xima (Idade M√≠nima de 15 anos)
            const minAgeDate = new Date(today.getFullYear() - 15, today.getMonth(), today.getDate());
            dateInput.setAttribute('max', minAgeDate.toISOString().split('T')[0]);

            // Data M√≠nima (Idade M√°xima de 100 anos)
            const maxAgeDate = new Date(today.getFullYear() - 100, today.getMonth(), today.getDate());
            dateInput.setAttribute('min', maxAgeDate.toISOString().split('T')[0]);
        }


        function checkOnboarding() {
            if (!userData.nome) {
                setDateLimits(); // Define os limites da data antes de mostrar a tela
                showScreen('onboarding-view');
            } else {
                showScreen('dashboard-view');
            }
        }

        function handleOnboardingSubmit(event) {
            event.preventDefault();

            // 1. Coleta e valida√ß√£o dos dados
            const nome = document.getElementById('onboarding-nome').value.trim();
            const dataNascimento = document.getElementById('onboarding-data-nascimento').value;
            const sexo = document.getElementById('onboarding-sexo').value;
            const peso = parseFloat(document.getElementById('onboarding-peso').value);
            const altura = parseInt(document.getElementById('onboarding-altura').value);
            const metaPeso = parseFloat(document.getElementById('onboarding-meta-peso').value);
            const metaSelecionada = document.getElementById('onboarding-meta-selecionada').value;
            const nivel = document.getElementById('onboarding-nivel').value;
            const idade = calculateAge(dataNascimento);


            if (!metaSelecionada) {
                alert('Por favor, selecione sua meta principal.');
                return;
            }
            
            // Valida√ß√£o de Altura
            if (isNaN(altura) || altura < 120 || altura > 220) {
                 alert('A altura deve estar entre 120 cm (1.20m) e 220 cm (2.20m).');
                 return;
            }
            
            // Valida√ß√£o de Idade (Garantir que a data √© v√°lida)
            if (idade === null || idade < 15 || idade > 100) {
                 alert('Por favor, insira uma data de nascimento v√°lida (idade entre 15 e 100 anos).');
                 return;
            }


            // 2. Atualiza o objeto userData
            userData.nome = nome;
            userData.dataNascimento = dataNascimento;
            userData.sexo = sexo;
            userData.pesoInicial = peso;
            userData.altura = altura;
            userData.metaPeso = metaPeso;
            userData.metaSelecionada = metaSelecionada;
            userData.nivel = nivel;
            
            // Adiciona o peso inicial ao hist√≥rico
            if (userData.pesoHistorico.length === 0 || userData.pesoHistorico[0].peso !== peso) {
                userData.pesoHistorico.push({ date: new Date().toISOString().split('T')[0], peso: peso });
            }

            // 3. Salva e navega
            saveUserData();
            showScreen('dashboard-view');
        }

        // ===================================
        // 4. L√ìGICA DO DASHBOARD
        // ===================================

        function renderDashboard() {
            const age = calculateAge(userData.dataNascimento);
            const nivelDisplay = userData.nivel.charAt(0).toUpperCase() + userData.nivel.slice(1);
            const metaFocoDisplay = getDisplayGoal(userData.metaSelecionada).split('(')[0].trim();
            const profilePicUrl = PROFILE_PICS[userData.nivel] || PROFILE_PICS.default;
            
            const treinosConcluidos = userHistory.treinosConcluidos; // NOVO

            document.getElementById('profile-picture').src = profilePicUrl;
            document.getElementById('dashboard-saudacao').textContent = `Ol√°, ${userData.nome.split(' ')[0]} üëã`;
            document.getElementById('dashboard-idade').textContent = isNaN(age) ? '--' : age;
            document.getElementById('dashboard-nivel').textContent = nivelDisplay;
            document.getElementById('dashboard-meta-foco').textContent = metaFocoDisplay;
            
            // NOVO: Atualiza contagem de treinos
            document.getElementById('treinos-count').textContent = treinosConcluidos.length;
            
            // NOVO: Exibe o √∫ltimo treino
            const lastTreino = treinosConcluidos.length > 0 
                ? `${treinosConcluidos[treinosConcluidos.length - 1].nome} (${new Date(treinosConcluidos[treinosConcluidos.length - 1].date).toLocaleDateString('pt-BR')})`
                : 'Nenhum registrado.';
            document.getElementById('last-treino-display').textContent = lastTreino;

            // Atualiza calorias e √°gua
            document.getElementById('cal-consumida').textContent = userData.calorias;
            // A meta cal√≥rica pode ser calculada com base na meta, mas aqui usamos um valor padr√£o para demonstra√ß√£o
            document.getElementById('cal-meta').textContent = userData.metaSelecionada === 'hipertrofia' ? '2500' : '1800'; 
            document.getElementById('agua-copos').textContent = userData.agua;

            // Simula Progresso Semanal (60%)
            document.getElementById('treino-pct').textContent = '60';
        }

        // L√≥gica de √Ågua
        function updateWater(change) {
            userData.agua = Math.max(0, userData.agua + change);
            document.getElementById('agua-copos').textContent = userData.agua;
            saveUserData();
        }
        
        // ===================================
        // 5. L√ìGICA DE TREINOS E EXECU√á√ÉO
        // ===================================

        function renderTreinoList() {
            const listContainer = document.getElementById('treino-list');
            listContainer.innerHTML = treinosData.map(treino => `
                <div class="card" style="border-left: 5px solid var(--primary-color);">
                    <h4 style="color: var(--text-color);">${treino.nome}</h4>
                    <p style="font-size: 0.85em; margin: 5px 0;">Foco: ${treino.foco}</p>
                    <button class="primary-btn btn-iniciar-treino" data-treino-id="${treino.id}" style="padding: 8px; margin-top: 5px;">
                        <i class="fas fa-play"></i> Iniciar
                    </button>
                </div>
            `).join('');

            document.querySelectorAll('.btn-iniciar-treino').forEach(btn => {
                btn.addEventListener('click', (e) => iniciarTreino(e.currentTarget.dataset.treinoId));
            });
        }

        function iniciarTreino(treinoId) {
            currentTreino = JSON.parse(JSON.stringify(treinosData.find(t => t.id === treinoId))); // Clone para n√£o alterar o original
            currentExercicioIndex = 0;
            currentSerie = 1;

            if (!currentTreino) {
                alert('Treino n√£o encontrado.');
                return;
            }
            
            // Adiciona a data de in√≠cio ao objeto do treino
            currentTreino.startTime = new Date().getTime();

            document.getElementById('treino-titulo-execucao').textContent = currentTreino.nome;
            renderExercicioEmExecucao();
            showScreen('execucao-view');
        }

        function renderExercicioEmExecucao() {
            const exercicio = currentTreino.exercicios[currentExercicioIndex];
            if (!exercicio) {
                finalizarTreino(true); // Se n√£o h√° mais exerc√≠cios, finaliza
                return;
            }

            // Exibe o exerc√≠cio atual
            document.getElementById('exercicio-nome').textContent = exercicio.nome;
            document.getElementById('serie-atual').textContent = currentSerie;
            document.getElementById('total-series').textContent = exercicio.series;
            document.getElementById('repeticoes').textContent = exercicio.reps;

            // Configura√ß√µes e detalhes
            document.getElementById('config-reps').value = exercicio.reps;
            document.getElementById('config-descanso').value = exercicio.descanso;
            document.getElementById('input-carga').value = exercicio.carga;
            document.getElementById('detalhe-movimento').value = exercicio.detalhe;

            // Atualiza a lista de exerc√≠cios (lado direito/abaixo)
            document.getElementById('exercicios-list').innerHTML = currentTreino.exercicios.map((ex, index) => `
                <p style="margin: 5px 0; padding: 5px; border-left: ${index === currentExercicioIndex ? '3px solid var(--primary-color)' : 'none'}; opacity: ${index < currentExercicioIndex ? 0.5 : 1};">
                    ${index + 1}. ${ex.nome} - ${ex.series}x${ex.reps}
                </p>
            `).join('');

            // Mostra/Esconde bot√£o de finalizar
            if (currentExercicioIndex === currentTreino.exercicios.length - 1 && currentSerie === exercicio.series) {
                document.getElementById('btn-finalizar-treino').style.display = 'block';
                document.getElementById('btn-completar-serie').textContent = 'Finalizar √öltima S√©rie';
            } else {
                document.getElementById('btn-finalizar-treino').style.display = 'none';
                document.getElementById('btn-completar-serie').textContent = 'Registrar S√©rie Conclu√≠da';
            }
        }
        
        function completarSerie() {
            const exercicio = currentTreino.exercicios[currentExercicioIndex];
            const totalSeries = parseInt(exercicio.series);

            // 1. Registra a carga (simula√ß√£o)
            exercicio.carga = document.getElementById('input-carga').value;
            
            // 2. Avan√ßa a s√©rie
            if (currentSerie < totalSeries) {
                currentSerie++;
                renderExercicioEmExecucao();
                
                // Inicia o descanso (tempo da nova s√©rie)
                timerDuration = parseInt(document.getElementById('config-descanso').value);
                initTimer(timerDuration);
            } else {
                // 3. Avan√ßa para o pr√≥ximo exerc√≠cio
                currentExercicioIndex++;
                currentSerie = 1;
                
                // Se n√£o houver pr√≥ximo exerc√≠cio, finaliza
                if (currentExercicioIndex >= currentTreino.exercicios.length) {
                    finalizarTreino(true);
                } else {
                    renderExercicioEmExecucao();
                    // Inicia descanso do pr√≥ximo exerc√≠cio
                    timerDuration = parseInt(document.getElementById('config-descanso').value); 
                    initTimer(timerDuration);
                }
            }
        }
        
        function finalizarTreino(isCompleted) {
            clearInterval(timerInterval);

            if (isCompleted) {
                // 1. C√°lculo da dura√ß√£o
                const durationMs = new Date().getTime() - currentTreino.startTime;
                const durationMin = Math.round(durationMs / 60000);

                // 2. Salvamento no Hist√≥rico
                userHistory.treinosConcluidos.push({
                    date: new Date().toISOString(),
                    nome: currentTreino.nome,
                    duracao: `${durationMin} min`,
                    totalExercicios: currentTreino.exercicios.length
                });
                saveUserHistory();
                
                alert(`Treino ${currentTreino.nome} conclu√≠do em ${durationMin} minutos com sucesso!`);
            } else {
                alert(`Treino ${currentTreino.nome} interrompido.`);
            }

            currentTreino = null;
            showScreen('dashboard-view');
        }

        // NOVO: L√≥gica para renderizar o Hist√≥rico de Treinos
        function renderHistoricoTreinos() {
            const listContainer = document.getElementById('historico-list-container');
            const totalCount = document.getElementById('historico-total-count');
            const historico = userHistory.treinosConcluidos.slice().reverse(); // Copia e inverte para o mais recente primeiro

            totalCount.textContent = historico.length;
            document.getElementById('historico-vazio').style.display = historico.length === 0 ? 'block' : 'none';

            if (historico.length > 0) {
                listContainer.innerHTML = historico.map(treino => {
                    const dataFormatada = new Date(treino.date).toLocaleDateString('pt-BR', {
                        day: '2-digit', month: '2-digit', year: 'numeric'
                    });
                    const horaFormatada = new Date(treino.date).toLocaleTimeString('pt-BR', {
                        hour: '2-digit', minute: '2-digit'
                    });

                    return `
                        <div class="historico-treino-item">
                            <h4>${treino.nome} <i class="fas fa-check-circle" style="color: var(--secondary-color); font-size: 0.9em;"></i></h4>
                            <p style="font-size: 0.85em; margin-top: 5px;">
                                <strong>Data:</strong> ${dataFormatada} √†s ${horaFormatada} <br>
                                <strong>Dura√ß√£o:</strong> ${treino.duracao} | 
                                <strong>Exerc√≠cios:</strong> ${treino.totalExercicios}
                            </p>
                        </div>
                    `;
                }).join('');
            } else {
                listContainer.innerHTML = document.getElementById('historico-vazio').outerHTML;
            }
        }


        // ===================================
        // 6. L√ìGICA DO CRON√îMETRO
        // ===================================

        function formatTime(totalSeconds) {
            const minutes = Math.floor(totalSeconds / 60);
            const seconds = totalSeconds % 60;
            return `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }

        function updateTimerDisplay() {
            document.getElementById('timer').textContent = formatTime(timerRemaining);
            document.getElementById('timer').style.color = timerRemaining <= 10 ? 'var(--danger-color)' : 'var(--primary-color)';

            if (timerRemaining <= 0) {
                clearInterval(timerInterval);
                timerRunning = false;
                document.getElementById('timer').textContent = "00:00 - Fim do Descanso!";
                document.getElementById('timer').style.color = 'var(--secondary-color)';
                
                // Simula um alarme
                const audio = new Audio('https://www.soundjay.com/buttons/beep-07.mp3'); // URL de som simples
                audio.play().catch(() => {}); // Tenta tocar o som, ignora erro se n√£o conseguir

                // Reseta para a dura√ß√£o da pr√≥xima s√©rie, mas n√£o inicia
                const proxDescanso = parseInt(document.getElementById('config-descanso').value);
                timerRemaining = proxDescanso;
                document.getElementById('timer').textContent = formatTime(timerRemaining);
                document.getElementById('timer').style.color = 'var(--danger-color)';
                document.getElementById('btn-timer-start').innerHTML = '<i class="fas fa-play"></i> Iniciar';
            }
        }

        function initTimer(duration) {
            clearInterval(timerInterval);
            timerRemaining = duration;
            updateTimerDisplay();
            document.getElementById('btn-timer-start').innerHTML = '<i class="fas fa-play"></i> Iniciar';
            document.getElementById('btn-timer-start').disabled = false;
            timerRunning = false;
        }

        function toggleTimer() {
            if (timerRunning) {
                clearInterval(timerInterval);
                timerRunning = false;
                document.getElementById('btn-timer-start').innerHTML = '<i class="fas fa-play"></i> Continuar';
            } else {
                if (timerRemaining === 0) {
                    initTimer(parseInt(document.getElementById('config-descanso').value));
                }
                
                timerInterval = setInterval(() => {
                    timerRemaining--;
                    updateTimerDisplay();
                }, 1000);
                timerRunning = true;
                document.getElementById('btn-timer-start').innerHTML = '<i class="fas fa-pause"></i> Descansando...';
            }
        }

        function resetTimer() {
            clearInterval(timerInterval);
            timerRunning = false;
            const defaultDuration = parseInt(document.getElementById('config-descanso').value);
            initTimer(defaultDuration);
            document.getElementById('btn-timer-start').innerHTML = '<i class="fas fa-play"></i> Iniciar';
        }
        
        // ===================================
        // 7. L√ìGICA DE DIETA
        // ===================================
        function handleRefeicaoSubmit(event) {
            event.preventDefault();
            const alimento = document.getElementById('input-alimento').value.trim();
            const calorias = parseInt(document.getElementById('input-calorias').value);

            if (alimento && !isNaN(calorias) && calorias > 0) {
                userData.calorias = (userData.calorias || 0) + calorias;
                // Simula√ß√£o de hist√≥rico de refei√ß√µes
                let historico = JSON.parse(localStorage.getItem('historicoRefeicoes')) || [];
                historico.push({ alimento, calorias, time: new Date().toLocaleTimeString('pt-BR', {hour: '2-digit', minute: '2-digit'}) });
                localStorage.setItem('historicoRefeicoes', JSON.stringify(historico));

                document.getElementById('input-alimento').value = '';
                document.getElementById('input-calorias').value = '';

                saveUserData();
                renderDashboard();
                renderHistoricoRefeicoes();
            }
        }
        
        function renderHistoricoRefeicoes() {
            const historicoList = document.getElementById('historico-refeicoes');
            let historico = JSON.parse(localStorage.getItem('historicoRefeicoes')) || [];
            
            historicoList.innerHTML = historico.map(item => `
                <li style="border-bottom: 1px dashed #ccc; padding: 5px 0; font-size: 0.9em;">
                    ${item.time} - <strong>${item.alimento}</strong> (${item.calorias} Kcal)
                </li>
            `).join('');
        }

        // ===================================
        // 8. L√ìGICA DE PROGRESSO
        // ===================================
        function handlePesoSubmit(event) {
            event.preventDefault();
            const pesoAtual = parseFloat(document.getElementById('input-peso').value);
            const today = new Date().toISOString().split('T')[0];

            if (!isNaN(pesoAtual) && pesoAtual > 0) {
                // Remove registro de peso duplicado no mesmo dia, ou atualiza o mais recente
                userData.pesoHistorico = userData.pesoHistorico.filter(entry => entry.date !== today);
                userData.pesoHistorico.push({ date: today, peso: pesoAtual });
                
                userData.pesoHistorico.sort((a, b) => new Date(a.date) - new Date(b.date));

                saveUserData();
                renderProgresso();
                alert(`Peso de ${pesoAtual} kg registrado com sucesso!`);
            }
        }

        function renderProgresso() {
            const currentPeso = userData.pesoHistorico.length > 0 ? userData.pesoHistorico[userData.pesoHistorico.length - 1].peso : userData.pesoInicial;
            const pesoInicial = userData.pesoInicial;
            let diferenca = 0;

            if (pesoInicial && currentPeso) {
                diferenca = (currentPeso - pesoInicial).toFixed(1);
            }

            document.getElementById('peso-atual-display').textContent = currentPeso ? `${currentPeso} Kg` : '-- Kg';
            document.getElementById('peso-inicial-display').textContent = pesoInicial ? `${pesoInicial} Kg` : '-- Kg';
            document.getElementById('peso-diferenca-display').textContent = `${diferenca > 0 ? '+' : ''}${diferenca} Kg`;

            updateWeightChart();
        }

        function updateWeightChart() {
            const ctx = document.getElementById('weight-chart');
            const labels = userData.pesoHistorico.map(entry => {
                const date = new Date(entry.date);
                return `${date.getDate()}/${date.getMonth() + 1}`;
            });
            const dataPoints = userData.pesoHistorico.map(entry => entry.peso);

            if (weightChart) {
                weightChart.destroy();
            }
            
            // Verifica se h√° dados suficientes
            if (dataPoints.length === 0) {
                ctx.innerHTML = '<p style="text-align: center; padding: 20px;">Sem dados de peso para exibir.</p>';
                return;
            }


            weightChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Peso (Kg)',
                        data: dataPoints,
                        borderColor: 'var(--primary-color)',
                        backgroundColor: 'rgba(0, 123, 255, 0.1)',
                        tension: 0.3
                    },
                    {
                        label: 'Meta',
                        data: Array(dataPoints.length).fill(userData.metaPeso),
                        borderColor: 'var(--secondary-color)',
                        borderDash: [5, 5],
                        pointRadius: 0
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: false,
                            title: {
                                display: true,
                                text: 'Peso (Kg)'
                            }
                        }
                    }
                }
            });
        }

        // ===================================
        // 9. L√ìGICA DE PERFIL
        // ===================================

        function renderPerfil() {
            document.getElementById('perfil-nome').textContent = userData.nome || '--';
            document.getElementById('perfil-idade').textContent = userData.dataNascimento ? calculateAge(userData.dataNascimento) : '--';
            document.getElementById('perfil-objetivo').textContent = getDisplayGoal(userData.metaSelecionada);
            document.getElementById('perfil-nivel').textContent = userData.nivel ? userData.nivel.charAt(0).toUpperCase() + userData.nivel.slice(1) : '--';
            document.getElementById('perfil-peso-inicial').textContent = userData.pesoInicial || '--';
            
            const currentTheme = localStorage.getItem('theme') || 'light';
            document.getElementById('tema-atual').textContent = currentTheme === 'light' ? 'CLARO' : (currentTheme === 'dark-mode' ? 'ESCURO' : 'HELLO KITTY');
        }

        function resetOnboarding() {
            if (confirm('Tem certeza que deseja apagar todos os seus dados e refazer o Onboarding? Isso inclui hist√≥rico de peso, treinos e refei√ß√µes.')) {
                localStorage.removeItem('userData');
                localStorage.removeItem('userHistory'); // NOVO: Remove hist√≥rico
                localStorage.removeItem('historicoRefeicoes');
                localStorage.removeItem('theme');
                userData = { nome: null, pesoHistorico: [] }; // Reinicia o objeto de dados
                userHistory = { treinosConcluidos: [] }; // Reinicia o hist√≥rico
                location.reload();
            }
        }
        
        // ===================================
        // 10. L√ìGICA DE CRIA√á√ÉO DE TREINO PERSONALIZADO
        // ===================================
        const personalizarTreinoView = document.getElementById('personalizar-treino-view');
        const btnMontarTreino = document.getElementById('btn-montar-treino');
        const btnVoltarDaPersonalizacao = document.getElementById('btn-voltar-da-personalizacao');
        const exercicioBancoList = document.getElementById('exercicio-banco-list');
        const exerciciosSelecionadosList = document.getElementById('exercicios-selecionados-list');
        const btnSalvarTreinoPersonalizado = document.getElementById('btn-salvar-treino-personalizado');
        const inputNomeNovoTreino = document.getElementById('input-nome-novo-treino');

        // Inicializa a lista de exerc√≠cios dispon√≠veis
        function renderizarBancoExercicios() {
            exercicioBancoList.innerHTML = ALL_EXERCISES.map(ex => `
                <div class="goal-option" data-nome="${ex.nome}" data-foco="${ex.foco}" data-carga="${ex.carga}" data-reps="${ex.reps}" data-series="${ex.series}" data-descanso="${ex.descanso}" data-detalhe="${ex.detalhe}" style="margin-bottom: 5px;">
                    <h4>+ ${ex.nome} <span style="color: var(--primary-color); font-size: 0.9em;">(${ex.foco})</span></h4>
                    <p style="font-size: 0.8em; opacity: 0.7;">Sugest√£o: ${ex.series}x${ex.reps} - ${ex.carga}kg</p>
                </div>
            `).join('');

            exercicioBancoList.querySelectorAll('.goal-option').forEach(item => {
                item.addEventListener('click', adicionarExercicioAoTreino);
            });
        }

        // Adiciona um exerc√≠cio ao treino personalizado
        function adicionarExercicioAoTreino(event) {
            const dataset = event.currentTarget.dataset;
            const nome = dataset.nome;
            
            const novoExercicio = { 
                nome: nome,
                series: parseInt(dataset.series),
                reps: parseInt(dataset.reps),
                carga: parseInt(dataset.carga),
                descanso: parseInt(dataset.descanso),
                detalhe: dataset.detalhe,
                id: Date.now() + Math.random() // ID √∫nico para remo√ß√£o
            }; 
            customTreino.exercicios.push(novoExercicio);
            renderizarExerciciosSelecionados();
        }

        // Renderiza a lista de exerc√≠cios que o usu√°rio j√° selecionou
        function renderizarExerciciosSelecionados() {
            if (customTreino.exercicios.length === 0) {
                exerciciosSelecionadosList.innerHTML = '<p style="text-align: center; color: #6c757d;">Nenhum exerc√≠cio adicionado ainda.</p>';
                return;
            }

            exerciciosSelecionadosList.innerHTML = customTreino.exercicios.map((ex, index) => `
                <div class="card" data-id="${ex.id}" style="padding: 10px; margin-bottom: 5px; display: flex; justify-content: space-between; align-items: center; border-left: 5px solid var(--primary-color);">
                    <div>
                        <strong>${index + 1}. ${ex.nome}</strong> 
                        <p style="font-size: 0.8em; margin: 0;">${ex.series}x${ex.reps} | ${ex.carga}kg</p>
                    </div>
                    <button class="primary-btn btn-remover-exercicio" data-id="${ex.id}" style="width: auto; padding: 5px 10px; margin-top: 0; background-color: var(--danger-color); font-size: 0.8em;">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            `).join('');

            exerciciosSelecionadosList.querySelectorAll('.btn-remover-exercicio').forEach(btn => {
                btn.addEventListener('click', removerExercicioDoTreino);
            });
        }

        function removerExercicioDoTreino(event) {
            const idParaRemover = parseFloat(event.currentTarget.dataset.id);
            customTreino.exercicios = customTreino.exercicios.filter(ex => ex.id !== idParaRemover);
            renderizarExerciciosSelecionados();
        }


        // ===================================
        // 11. INICIALIZA√á√ÉO E EVENT LISTENERS
        // ===================================

        document.addEventListener('DOMContentLoaded', () => {
            
            // Onboarding Goal Selection
            document.querySelectorAll('.goal-option').forEach(option => {
                option.addEventListener('click', (e) => {
                    document.querySelectorAll('.goal-option').forEach(opt => opt.classList.remove('selected'));
                    e.currentTarget.classList.add('selected');
                    document.getElementById('onboarding-meta-selecionada').value = e.currentTarget.dataset.goal;
                });
            });

            // Onboarding Submit
            document.getElementById('onboarding-form').addEventListener('submit', handleOnboardingSubmit);

            // Navigation
            document.querySelectorAll('.nav-btn, .nav-link').forEach(element => {
                element.addEventListener('click', (e) => {
                    const target = e.currentTarget.dataset.target;
                    if (target) {
                        showScreen(target);
                    }
                });
            });
            
            // Header Theme Toggles
            document.getElementById('dark-mode-toggle').addEventListener('click', () => {
                const current = localStorage.getItem('theme') === 'dark-mode';
                applyThemeImmediate(current ? 'light' : 'dark-mode');
            });

            document.getElementById('hello-kitty-toggle').addEventListener('click', () => {
                const current = localStorage.getItem('theme') === 'hello-kitty-theme';
                applyThemeImmediate(current ? 'light' : 'hello-kitty-theme');
            });

            document.getElementById('btn-mudar-tema-config').addEventListener('click', () => {
                const current = localStorage.getItem('theme');
                if (current === 'light') {
                    applyThemeImmediate('dark-mode');
                } else if (current === 'dark-mode') {
                    applyThemeImmediate('hello-kitty-theme');
                } else {
                    applyThemeImmediate('light');
                }
                renderPerfil();
            });

            // Water Controls
            document.getElementById('btn-add-agua-plus').addEventListener('click', () => updateWater(1));
            document.getElementById('btn-add-agua-minus').addEventListener('click', () => updateWater(-1));

            // Timer Controls
            document.getElementById('btn-timer-start').addEventListener('click', toggleTimer);
            document.getElementById('btn-timer-pause').addEventListener('click', toggleTimer);
            document.getElementById('btn-timer-reset').addEventListener('click', resetTimer);
            
            // Treino Execution Controls
            document.getElementById('btn-completar-serie').addEventListener('click', completarSerie);
            document.getElementById('btn-voltar-treino').addEventListener('click', () => {
                if (confirm('Voc√™ tem certeza que quer sair do treino? O progresso desta sess√£o ser√° perdido.')) {
                    finalizarTreino(false); // Sair sem concluir
                }
            });
            document.getElementById('btn-finalizar-treino').addEventListener('click', () => finalizarTreino(true));
            
            // Dieta
            document.getElementById('form-refeicao').addEventListener('submit', handleRefeicaoSubmit);
            
            // Progresso
            document.getElementById('form-peso').addEventListener('submit', handlePesoSubmit);
            document.getElementById('btn-reset-onboarding').addEventListener('click', resetOnboarding);

            // L√≥gica de Cria√ß√£o de Treino Personalizado
            btnMontarTreino.addEventListener('click', () => {
                showScreen('personalizar-treino-view');
                customTreino = { nome: '', exercicios: [] }; // Inicia novo treino
                inputNomeNovoTreino.value = '';
                renderizarBancoExercicios();
                renderizarExerciciosSelecionados();
            });

            btnVoltarDaPersonalizacao.addEventListener('click', () => {
                showScreen('treinos-view');
                renderTreinoList(); 
            });

            btnSalvarTreinoPersonalizado.addEventListener('click', () => {
                if (customTreino.exercicios.length === 0) {
                    alert('Adicione pelo menos um exerc√≠cio ao treino!');
                    return;
                }

                const nomeTreino = inputNomeNovoTreino.value.trim() || 'Meu Treino Personalizado';
                customTreino.nome = nomeTreino;

                // Cria uma estrutura de treino que se encaixa no treinosData
                const novoTreinoSalvo = { 
                    id: 'custom-' + Date.now(), 
                    nome: nomeTreino, 
                    foco: 'Personalizado', 
                    exercicios: customTreino.exercicios 
                };
                
                // Adiciona √† lista
                treinosData.push(novoTreinoSalvo);

                // Inicia o treino rec√©m-criado
                iniciarTreino(novoTreinoSalvo.id);
            });


            // Initial Check
            checkOnboarding();
            renderHistoricoRefeicoes();
        });
        const dataInput = document.getElementById('onboarding-data-nascimento');
const dataError = document.getElementById('data-error');

dataInput.addEventListener('input', function (e) {
  let value = e.target.value.replace(/\D/g, ''); // remove tudo que n√£o √© n√∫mero

  // adiciona / automaticamente (formato dd/mm/aaaa)
  if (value.length >= 3 && value.length <= 4)
    value = value.replace(/^(\d{2})(\d+)/, '$1/$2');
  else if (value.length >= 5)
    value = value.replace(/^(\d{2})(\d{2})(\d+)/, '$1/$2/$3');

  e.target.value = value;
});

dataInput.addEventListener('blur', function () {
  const value = dataInput.value;
  const [dia, mes, ano] = value.split('/').map(Number);
  const hoje = new Date();
  const data = new Date(ano, mes - 1, dia);

  const valida =
    dia >= 1 &&
    mes >= 1 && mes <= 12 &&
    ano >= 1925 && ano <= hoje.getFullYear() &&
    data <= hoje;

  if (!valida || isNaN(data.getTime())) {
    dataError.style.display = 'block';
    dataInput.style.borderColor = 'red';
  } else {
    dataError.style.display = 'none';
    dataInput.style.borderColor = '';
  }
});

    </script>
</body>

</html>

